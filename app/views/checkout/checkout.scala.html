@(order: Order)(implicit user:Option[Profile])
@import helper._
@main(Messages("order.checkout.title"), user, false) {
<script src="@routes.Assets.at("javascripts/area.js")" type="text/javascript"></script>
    <div class="w m2">
        <div id="checkout">
            <div class="mt">
                <h2>填写并核对订单信息</h2>
            </div>
            <div id="wizard" class="checkout-steps">
                <div id="step-1" class="step step-complete">
                    <div class="step-title">
                        <div id="save-consignee-tip" class="step-right">
                        </div>
                        <strong id="consigneeTitleDiv">收货人信息</strong>
                        <span class="step-action" id="consignee_edit_action">
                            <a href="javascript:void(0)" id="consigneeEditBtn" onclick="javascript:modifyConsignee()">[修改]</a>
                            <a href="#none" id="saveConsigneeTitleMinDiv" style="color:#005EA7;" onclick="save_Consignee()">保存收货人信息</a>
                        </span>
                    </div>
                    <div class="step-content">
                        <div id="consignee" class="sbox-wrap">
                            <div class="sbox">
                                @user.get.defaultAddress match {
                                    case Some(address) =>{
                                        <script type="text/javascript">
                                            $("#consigneeEditBtn").show();
                                            $("#saveConsigneeTitleMinDiv").hide();
                                            $("#consigneeInfoForm").show();
                                        </script>
                                        <div class="s-content">
                                            <input type="hidden" id="hideAreaIds" value="@address.id"><!--icon隐藏域-->
                                            <p>
                                                @address.contactPerson &nbsp; @address.contactPhone &nbsp; @address.area.get.name  &nbsp;
                                                <br>
                                                @address
                                            </p>
                                        </div>
                                    }
                                    case _ =>{

                                    }
                                }
                                <div id="consigneeInfoForm" class="form" style="display:none">
                                    <div id="consignee-list" name="consignee-list">
                                        <input type="hidden" id="hidden_consignees_size" value="8">
                                        @for((address, idx) <- user.get.addresses.zipWithIndex){
                                            <div class="item @(if(address.isDefault.isDefined & address.isDefault.get) "item-selected")" id="item_@address.id" index="consignee_@idx">
                                                <!--hidden 隐藏参数 开始 -->
                                                <input type="hidden" id="hidden_consignee_id_@address.id" value="@address.id">
                                                <input type="hidden" id="hidden_consignee_name_@address.id" value="@address.contactPerson">
                                                <input type="hidden" id="hidden_consignee_province_@address.id" value="@address.province">
                                                <input type="hidden" id="hidden_consignee_city_@address.id" value="@address.city">
                                                <input type="hidden" id="hidden_consignee_district_@address.id" value="@address.district">
                                                <input type="hidden" id="hidden_consignee_addressLine_@address.id" value="@address.addressLine">
                                                <input type="hidden" id="hidden_consignee_mobile_@address.id" value="@address.contactPhone">
                                                <input type="hidden" id="hidden_consignee_areaId_@address.id" value="@address.areaId">
                                                <input type="hidden" id="hidden_consignee_areaName_@address.id" value="@address.area.get.name">
                                                <!--hidden 隐藏参数 结束-->
                                                <input type="radio" class="hookbox" name="consignee_radio" id="consignee_radio_@address.id" value="@address.id"  @(if(address.isDefault.isDefined & address.isDefault.get) "checked") onclick="choseConsignee('@address.id')">
                                                <label for="consignee_radio_@address.id" onclick="chose_Consignee('@address.id')">
                                                    <b>@address.contactPerson</b>&nbsp; @address &nbsp; @address.contactPhone &nbsp;
                                                </label>
                                                 <span class="item-action" style="display: inline;">
                                                   <a href="#none" onclick="showConsigneeDetail()">编辑</a> &nbsp;
                                                      <a href="#none" onclick="deleteConsignee('@address.id')">删除</a>&nbsp;
                                                 </span>
                                            </div>
                                        }

                                    </div>

                                    <!--更多常用收货人--->
                                    <div class="address-list">
                                        <div class="inner group">
                                            <div id="select-more" class="select-expand"><span onclick="open_MoreConsignee()">更多常用地址</span><s></s></div>
                                        </div>
                                    </div>


                                    <!---详细收货人信息表单--->
                                    <div class="item" id="use-new-address"><a name="editConsignee"></a>
                                        <input type="radio" onclick="use_NewConsignee()" class="hookbox" name="consignee_radio" id="consignee_radio_new">
                                        <label for="consignee_radio_new">使用新地址 </label><span id="addNumLimitNote" class="status error" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 当前地址数量已达上限，若要继续添加新地址，请先删除部分收货地址。</span>
                                    </div>
                                        @form(routes.ProfileController.updateAddress){
                                        <div class="consignee-form" id="consignee-form" name="consignee-form" style="padding-left:12px; display:none">
                                            <input type="hidden" name="id" id="id"/>
                                            <input type="hidden" name="areaId" id="areaId"/>
                                            <div class="list" id="name_div">
                                                <span class="label"><em>*</em>@Messages("addr.contactperson.label")</span>
                                                <div class="field">
                                                    <input type="text" class="textbox" id="contactPerson" name="contactPerson" maxlength="20" onblur="check_Consignee('name_div')">
                                                </div>
                                                <span class="status error" id="name_div_error"></span>
                                            </div>
                                            <div class="list select-address" id="area_div">
                                                <span class="label"><em>*</em>所在地区：</span>
                                                <div class="field">
                                                    <span id="span_area">
                                                       <span id="span_province">
                                                            <select id="province" name="province"><option value="sc">@util.AddressInfo.provinceName("sc")</option></select>
                                                       </span>
                                                       <span id="span_city"><select id="city" name="city"><option value="cd">@util.AddressInfo.cityName("cd")</option></select></span>
                                                       <span id="span_county">
                                                           <select id="district" name="district" onchange="loadTowns()">
                                                               @for(dist <- (util.AddressInfo.cityDistrictMap.get("cd").get)){
                                                               <option value="@dist">@util.AddressInfo.distName(dist)</option>
                                                               }
                                                           </select>

                                                       </span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="list" id="email_div">
                                                <span class="label"><em></em>@Messages("addr.area.label")</span>
                                                <div class="field">
                                                    <input type="text" class="textbox" id="areaName" name="areaName" maxlength="50" onblur="check_Consignee('email_div')">
                                                    <a class="btn-12" href="#none" id="choosearea" onclick="showAreaTree()"><s></s>@Messages("addr.area.btn")</a>
                                                </div>
                                                <span class="status error" id="email_div_error"></span>
                                            </div>
                                            <div class="list" id="call_div">
                                                <span class="label"><em>*</em>手机号码：</span>
                                                <div class="field">
                                                    <div class="phone">
                                                        <input type="text" class="textbox" id="contactPhone" name="contactPhone" onblur="check_Consignee('call_mobile_div')" maxlength="11" onkeyup="check_Phone('call_mobile_div')">
                                                    </div>
                                                    <span class="status error" id="call_div_error"></span>
                                                </div>
                                            </div>
                                            <div class="list full-address" id="address_div">
                                                <span class="label"><em>*</em>详细地址：</span>
                                                <div class="field">
                                                    <span class="fl selected-address" id="areaNameTxt"></span>
                                                    <input type="text" class="textbox" id="addressLine" name="addressLine" maxlength="50" onblur="check_Consignee('address_div')">
                                                </div>
                                                <span class="status error" id="address_div_error"></span>
                                            </div>
                                        </div>
                                }
                                    <div class="form-btn group">
                                        <a href="#none" class="btn-submit" onclick="save_Consignee()"><span id="saveConsigneeTitleDiv">保存收货人信息</span></a>
                                        <div class="loading loading-1" style="display:none"><b></b>正在提交信息，请等待！</div>
                                    </div>
                                    <div style="display:none"><input id="consignee_form_reset" name="" type="reset"></div>

                                </div>


                            </div>						</div><!--end div#consignee-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="tree" style="display:none;overflow: hidden">

    </div>
    <script type="text/javascript">
        function modifyConsignee(){
            $(".s-content").hide();
            $(".form").show();
            var addressId = $("input[type=radio]:checked","#consignee-list").val();
            choseConsignee(addressId);
        }

        function choseConsignee(addressId){
            $(".item").removeClass("item-selected");
            $("#item_" + addressId).addClass("item-selected");
            $("#id").val($("#hidden_consignee_id_" + addressId).val());
            $("#areaId").val($("#hidden_consignee_areaId_" + addressId).val());
            $("#contactPerson").val($("#hidden_consignee_name_" + addressId).val());
            $("#province").val($("#hidden_consignee_province_" + addressId).val());
            $("#city").val($("#hidden_consignee_city_" + addressId).val());
            $("#district").val($("#hidden_consignee_district_" + addressId).val());
            $("#areaName").val($("#hidden_consignee_areaName_" + addressId).val());
            $("#contactPhone").val($("#hidden_consignee_mobile_" + addressId).val());
            $("#addressLine").val($("#hidden_consignee_addressLine_" + addressId).val());
        }

        function showConsigneeDetail(){
            $("#consignee-form").show();
        }

    </script>
}